# 功能实现

## 文件

### 新建

新建的逻辑有下面几种情况:
- 刚打开的时候新建，那就只需要将文本编辑区域显示出来
- 打开文件：
1. 进行了修改，弹出是否保存，选择保存或者不保存都清空文本编辑区域，选择取消就什么都不做。 
2. 没有修改就直接清空文本编辑区域
- 新建了后写了内容没有保存，弹出是否保存，后面的和打开文件一样

这里就要用到 `webContents`:
```
  // win 是 `BrowserWindow` 对象 ，消息类型是 `action` ，消息内容是 `new`
  // 这句话添加在新建的点击事件中
  win.webContents.send('action', 'new');
```

主进程发送消息后，渲染进程监听到消息后，将文本编辑区域显示出来:
```
// index.js

// 渲染进程异步通信模块导入
const ipc = require('electron').ipcRenderer;

// 监听主进程
ipc.on('action', (event, message, others) => {
  // 以后还有别的同类型消息需要处理，所以用 switch 
  switch(message){
    case 'new':
      document.getElementById('txtEditor').style.display = 'block';
      break;
  };
})
```

### 打开

这里我们需要用到系统对话框，根据 `electron API 示例` 中的说明，可以通过使用主进程的模块 `dialog` 来调用:
```
// main.js

// 主进程异步通信模块和对话框模块导入
const ipc = require('electron').ipcMain;
const dialog = require('electron').dialog;

// 打开的点击函数中添加
dialog.showOpenDialog({}, 
    function (filepath) {
      if (filepath) win.webContents.send('action', 'open', filepath);
});
```

渲染进程接收到主进程发送的消息后，根据文件路径打开文件并将内容渲染到文本编辑区域:
```
// index.js
// 渲染进程文件系统模块导入
const fs = require('fs');

// switch 中添加
 case 'open':
            fs.readFile(others[0], 'utf8', (err, data) => {
                if (err) console.log(err);
                
                // 如果是刚打开，需要将文本编辑区域可视化
                if (!document.getElementById('txtEditor').style.display)
                    document.getElementById('txtEditor').style.display = 'block';
                    
                // 将读取内容写到文本编辑区域
                document.getElementById('txtEditor').value = data;
            })
            break;
```


